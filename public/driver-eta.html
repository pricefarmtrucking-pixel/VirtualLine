<!doctype html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VirtualLine • ETA Update</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#0b1016;color:#e8f0fb}
.wrap{max-width:680px;margin:24px auto;padding:16px}
.card{background:#111924;border:1px solid #213044;border-radius:12px;padding:16px}
input,button{background:#0b1016;color:#e8f0fb;border:1px solid #2a3b52;border-radius:8px;padding:10px 12px}
button{cursor:pointer;font-weight:700}
.muted{color:#9fb0c2}
.row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
</style></head>
<body>
<div class="wrap">
  <h1>Update Your Arrival</h1>
  <div class="card">
    <p class="muted">Your ETA has passed. Please tell us your status:</p>
    <div class="row">
      <button id="arrived">I have arrived</button>
      <button id="neweta">I have a new ETA</button>
      <button id="cancel">Cancel this visit</button>
    </div>
    <div id="etaRow" class="row" style="display:none">
      <input id="etaMin" placeholder="New ETA (minutes)" />
      <button id="saveEta">Save ETA</button>
    </div>
    <p id="msg" class="muted"></p>
  </div>
</div>
<script>
const params=new URLSearchParams(location.search);
const truck=params.get('truck');
async function j(url,opts={}){const r=await fetch(url,Object.assign({headers:{'Content-Type':'application/json'}},opts));return r.json();}
document.getElementById('arrived').onclick=async()=>{
  const out=await j('/api/admin/queue/update-status',{method:'POST',body:JSON.stringify({truck_id:Number(truck),status:'Arrived'})});
  document.getElementById('msg').textContent=out.ok?'Thanks — marked Arrived.':(out.error||'Error');
};
document.getElementById('neweta').onclick=()=>{document.getElementById('etaRow').style.display='flex';};
document.getElementById('saveEta').onclick=async()=>{
  const n=Number(document.getElementById('etaMin').value);
  if(!Number.isFinite(n)||n<=0){alert('Enter a positive number');return;}
  const out=await j('/api/admin/queue/set-eta',{method:'POST',body:JSON.stringify({truck_id:Number(truck),eta_minutes:n})});
  document.getElementById('msg').textContent=out.ok?'Updated ETA.':(out.error||'Error');
};
document.getElementById('cancel').onclick=async()=>{
  const out=await j('/api/admin/queue/update-status',{method:'POST',body:JSON.stringify({truck_id:Number(truck),status:'Departed'})});
  document.getElementById('msg').textContent=out.ok?'Canceled this visit.':(out.error||'Error');
};
</script>
</body></html>
